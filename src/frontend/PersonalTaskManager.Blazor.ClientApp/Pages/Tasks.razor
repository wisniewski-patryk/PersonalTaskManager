@page "/tasks"

@using System.Net.Http
@using System.Net.Http.Json
@inject HttpClient httpClient

<h1>Todo</h1>

<div class="input-group mb-3">
	<input type="text" class="form-control" placeholder="Something todo" @bind="newTask" />
	<input type="text" class="form-control" placeholder="Write description" @bind="newDescription"/>
	<button class="btn btn-secondary" @onclick="AddTodo">Add todo</button>

</div>

<ul>
	@foreach (var task in tasks)
	{
		<li>
			<TaskItem Task="task"/>
		</li>
	}
</ul>

@code {
	private List<TaskDto> tasks = new();
	private string? newTask;
	private string? newDescription;
	private void AddTodo(){
		if (!string.IsNullOrWhiteSpace(newTask))
		{
			if (tasks is null){
				throw new NullReferenceException();
			}
			tasks.Add(new TaskDto { Name = newTask, Description = newDescription });
			newTask = string.Empty;
			newDescription = string.Empty;
		}
	} 
	protected override async Task OnInitializedAsync()
	{
		
		tasks = await httpClient.GetFromJsonAsync<List<TaskDto>>("/api/v0/tasks") ?? new();
	}
}